---
import Layout from "../layouts/Layout.astro";
import GhostRunner from "../components/GhostRunner.astro";
import BentoGrid from "../components/BentoGrid.astro";
import BentoCard from "../components/BentoCard.astro";
import SidebarNavigation from "../components/SidebarNavigation.astro";
import ThemeToggle from "../components/ThemeToggle.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Import hero images for optimization
import dotThreadsHero from "../assets/projects/dot-threads/hero-dothreads.gif";
import deturHero from "../assets/projects/detur/hero-detur.png";
import pikoHero from "../assets/projects/piko/hero-piko.gif";
import sanctuaryHero from "../assets/projects/santuary/hero-santuary.png";
import tirupatiHero from "../assets/projects/tirupati/hero-tirupati.gif";
import serendipityHero from "../assets/projects/serendipity/hero-serendipidity.png";

// Fetch all projects
const allProjects = (await getCollection("projects"))
	.filter((project) =>
		[
			"detour",
			"tirupati-campus",
			"skywalk-sanctuary",
			"dot-threads",
			"serendipidity",
			"piko",
			"musibuddy",
		].includes(project.slug),
	)
	.sort((a, b) => (a.data.order || 0) - (b.data.order || 0));

const heroImages: Record<string, ImageMetadata> = {
	"dot-threads": dotThreadsHero,
	detour: deturHero,
	piko: pikoHero,
	"skywalk-sanctuary": sanctuaryHero,
	"tirupati-campus": tirupatiHero,
	serendipidity: serendipityHero,
};

// Home bento sizing override so cards keep simple proportions / layout
const homeBentoSizeBySlug: Record<
	string,
	"small" | "medium" | "large" | "wide" | "tall"
> = {
	"dot-threads": "medium",
	detour: "medium",
	piko: "medium",
	"skywalk-sanctuary": "medium",
	"tirupati-campus": "medium",
	serendipidity: "medium",
	musibuddy: "medium",
};

// Convenience references by slug for manual column layout
const dotThreadsProject = allProjects.find(
	(project) => project.slug === "dot-threads",
);
const sanctuaryProject = allProjects.find(
	(project) => project.slug === "skywalk-sanctuary",
);
const detourProject = allProjects.find((project) => project.slug === "detour");
const tirupatiProject = allProjects.find(
	(project) => project.slug === "tirupati-campus",
);
const pikoProject = allProjects.find((project) => project.slug === "piko");
const serendipityProject = allProjects.find(
	(project) => project.slug === "serendipidity",
);
const musibuddyProject = allProjects.find(
	(project) => project.slug === "musibuddy",
);
---

<Layout
	title="Narayan Ashanahalli"
	description="Hi! I‚Äôm a graduate student at CMU HCI & SoA. I work at the intersection of sensing, computing, and IxD to create playful, intentional experiences between human -human and human - AI interactions"
	fullWidth={true}
>
	<!-- Fixed Nav: Top Right -->
	<div class="fixed-nav-top-right">
		<div class="nav-wrapper-mobile">
			<SidebarNavigation isHome={true} />
		</div>
	</div>

	<div class="toggle-floater">
		<div class="sidebar-controls">
			<ThemeToggle />
		</div>
	</div>

	<div class="home-content">
		<!-- LAYER 1: HERO / INTRO -->
		<section class="hero" id="about">
			<div class="hero-container">
				<!-- Game: Full Width Top -->
				<div class="game-fullbleed">
					<GhostRunner />
				</div>

				<div class="bio-content">
					<div class="hero-headline bio-short">
						üëã I‚Äôm Narayan, a Designer and graduate student at
						Carnegie Mellon University focused on building playful
						<span class="emoji-hover" data-emoji="ü§ù"
							>human-human</span
						> and
						<span class="emoji-hover" data-emoji="üòÑü§ñ"
							>human-machine</span
						> interactions. With a foundation in architecture, I use <span
							class="highlight"
							><span class="u-item"
								><span class="emoji-hover" data-emoji="‚öôÔ∏è"
									>systems thinking</span
								></span
							></span
						> and <span class="highlight"
							><span class="u-item"
								><span class="emoji-hover" data-emoji="üõ†Ô∏è"
									>rapid prototyping</span
								></span
							></span
						> to create digital products that feel responsive, intentional
						and are grounded in existing ecosystems.
					</div>
					<div class="hero-headline bio-long">
						<div class="bio-text">
							I'm Narayan, a Designer and graduate student at
							Carnegie Mellon University focused on building
							playful <span class="emoji-hover" data-emoji="ü§ù"
								>human-human</span
							> and <span class="emoji-hover" data-emoji="üòÑü§ñ"
								>human-machine</span
							> interactions. With a foundation in architecture, I use
							<span class="emoji-hover" data-emoji="‚öôÔ∏è"
								>systems thinking</span
							> and <span class="emoji-hover" data-emoji="üõ†Ô∏è"
								>rapid prototyping</span
							> to create digital products that feel responsive, intentional
							and are grounded in existing ecosystems.
							<br /><br />
							üéØ I care about creating joyful interactions ‚Äî whether
							that's between people or between people and interfaces.
							The core question I keep coming back to: how do we make
							technology feel playful and present in the physical world
							rather than extracting people into screens? I'm interested
							in interactions that feel natural, where the interface
							fades into the background and people can focus on what
							they're actually doing.
							<br /><br />
							üõ†Ô∏è For me, craft is the intuition we develop working with
							tools over time. It's about guiding people's attention
							so effortlessly that they don't think about the design
							at all. When I'm designing, I'm thinking about how people
							move, where their eyes go, what opportunities exist in
							those movements. The goal is always making things simple
							‚Äî design should enable what people want to do, not become
							the work itself.
							<br /><br />
							‚ú® What I've been up to and where I want to head: I'm
							learning that boring infrastructure work is where real
							impact happens. Building repositories, information architecture,
							systems that let others create and scale. My design thinking
							is evolving toward understanding that the best design
							disappears. I want to contribute to making technology
							that helps people stay present with each other and the
							world around them, creating tools that feel like extensions
							of how people naturally think and interact rather than
							systems they have to manage.
						</div>
					</div>
					<div class="emoji-display"></div>
				</div>

				<div class="hero-actions-row">
					<button id="read-more-btn" class="action-link read-more">
						Read more
						<svg
							width="12"
							height="12"
							viewBox="0 0 12 12"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
							class="chevron"
						>
							<path
								d="M2.5 4.5L6 8L9.5 4.5"
								stroke="currentColor"
								stroke-width="1.5"
								stroke-linecap="round"
								stroke-linejoin="round"></path>
						</svg>
					</button>

					<div class="hero-actions">
						<a
							href="https://linkedin.com/in/narayan-ashanahalli/"
							target="_blank"
							rel="noopener noreferrer"
							class="action-link">LinkedIn</a
						>
						<a
							href="https://www.instagram.com/narayan.3dm/"
							target="_blank"
							rel="noopener noreferrer"
							class="action-link">Instagram</a
						>
						<a
							href="https://github.com/narayan-works"
							target="_blank"
							rel="noopener noreferrer"
							class="action-link">GitHub</a
						>
						<a
							href="https://drive.google.com/file/d/1z9FwSv_cy2_RxAijZzFVZaNBnRlbI5rQ/view?usp=sharing"
							target="_blank"
							rel="noopener noreferrer"
							class="action-link">CV</a
						>
					</div>
				</div>
			</div>
		</section>

		<!-- LAYER 2: WORKS -->
		<section id="works" class="layer-works">
			<div class="works-container">
				<BentoGrid>
					<div>
						{
							dotThreadsProject && (
								<BentoCard
									title={dotThreadsProject.data.title}
									image={
										heroImages[dotThreadsProject.slug] ||
										dotThreadsProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${dotThreadsProject.slug}`}
									size={
										homeBentoSizeBySlug[
											dotThreadsProject.slug
										] ||
										(dotThreadsProject.data
											.bentoSize as any) ||
										"small"
									}
									tags={dotThreadsProject.data.tags}
								/>
							)
						}

						{
							tirupatiProject && (
								<BentoCard
									title={tirupatiProject.data.title}
									image={
										heroImages[tirupatiProject.slug] ||
										tirupatiProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${tirupatiProject.slug}`}
									size={
										homeBentoSizeBySlug[
											tirupatiProject.slug
										] ||
										(tirupatiProject.data
											.bentoSize as any) ||
										"small"
									}
									tags={tirupatiProject.data.tags}
								/>
							)
						}
					</div>

					<div>
						{
							detourProject && (
								<BentoCard
									title={detourProject.data.title}
									image={
										heroImages[detourProject.slug] ||
										detourProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${detourProject.slug}`}
									size={
										homeBentoSizeBySlug[
											detourProject.slug
										] ||
										(detourProject.data.bentoSize as any) ||
										"small"
									}
									tags={detourProject.data.tags}
								/>
							)
						}

						{
							serendipityProject && (
								<BentoCard
									title={serendipityProject.data.title}
									image={
										heroImages[serendipityProject.slug] ||
										serendipityProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${serendipityProject.slug}`}
									size={
										homeBentoSizeBySlug[
											serendipityProject.slug
										] ||
										(serendipityProject.data
											.bentoSize as any) ||
										"small"
									}
									tags={serendipityProject.data.tags}
								/>
							)
						}

						{
							sanctuaryProject && (
								<BentoCard
									title={sanctuaryProject.data.title}
									image={
										heroImages[sanctuaryProject.slug] ||
										sanctuaryProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${sanctuaryProject.slug}`}
									size={
										homeBentoSizeBySlug[
											sanctuaryProject.slug
										] ||
										(sanctuaryProject.data
											.bentoSize as any) ||
										"small"
									}
									tags={sanctuaryProject.data.tags}
								/>
							)
						}
					</div>

					<div>
						{
							pikoProject && (
								<BentoCard
									title={pikoProject.data.title}
									image={
										heroImages[pikoProject.slug] ||
										pikoProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${pikoProject.slug}`}
									size={
										homeBentoSizeBySlug[pikoProject.slug] ||
										(pikoProject.data.bentoSize as any) ||
										"small"
									}
									tags={pikoProject.data.tags}
								/>
							)
						}

						{
							musibuddyProject && (
								<BentoCard
									title={musibuddyProject.data.title}
									image={
										heroImages[musibuddyProject.slug] ||
										musibuddyProject.data.heroImage
									}
									loading="eager"
									fetchPriority="high"
									href={`/works/${musibuddyProject.slug}`}
									size={
										homeBentoSizeBySlug[
											musibuddyProject.slug
										] ||
										(musibuddyProject.data
											.bentoSize as any) ||
										"small"
									}
									tags={musibuddyProject.data.tags}
									fit="cover"
									scale={1.5}
								/>
							)
						}
					</div>
				</BentoGrid>
			</div>
		</section>

		<div class="footer-alignment-wrapper">
			<Footer />
		</div>
	</div>
</Layout>

<style>
	/* Fixed Nav Positions */
	.fixed-nav-top-right {
		position: fixed;
		top: 20px;
		right: 20px;
		z-index: 200;
		width: 280px; /* 320px col - 40px padding = 280px content width */
	}

	/* Desktop (3-col): shrink sidebar to maintain 3rem gap with content */
	@media (min-width: 1200px) {
		.fixed-nav-top-right {
			/* 
			   Aligned to Right:
			   - Available Space = 33vw (Col 3) - 20px (Right) - 3rem (Gap) - SocialWidth (~140px)
			   - 33vw - 210px
			*/
			width: clamp(200px, calc(33vw - 210px), 280px);
		}
	}

	.fixed-nav-bottom-right {
		position: fixed;
		bottom: 20px;
		right: 20px;
		z-index: 100;
		width: auto; /* Allow it to shrink to content */
		display: flex; /* Ensure proper stacking if multiple items */
		justify-content: flex-end;
		transition: bottom 0.1s ease-out; /* Smooth collision movement */
	}

	.toggle-floater {
		position: fixed;
		bottom: 20px;
		right: 20px;
		z-index: 100;
		width: auto;
		display: flex;
		justify-content: flex-end;
		transition: bottom 0.1s ease-out;
	}

	.sidebar-controls {
		display: flex;
		gap: 1rem;
		align-items: center;
	}

	/* Content Area */
	/* Content Area */
	.home-content {
		padding: 20px 20px 0; /* Match 20px nav offset, 0 bottom padding so footer margin controls spacing */
		max-width: 100%;
		margin: 0;
		width: 100%;
		position: relative; /* Context for absolute game */
	}

	/* Hero Section - Grid Layout to Match Bento */
	.hero-container {
		display: grid;
		grid-template-columns: 1fr; /* Mobile Default */
		gap: var(--space-md);
		width: 100%;
		padding-top: 160px; /* Game height spacer */
	}

	.game-fullbleed {
		grid-column: 1 / -1;
		width: 100%;
		position: absolute;
		top: 0;
		left: 0;
		z-index: 0;
	}

	.game-fullbleed :global(.ghost-game-container) {
		border-radius: 0;
		border: none;
		width: 100%;
	}

	/* Adjust Hero Container to accommodate absolute game */
	/* Since game is absolute, it doesn't take space. Bio will move up. */
	/* We need to push content down by the game height (160px + margin) */
	.hero-container {
		display: grid;
		grid-template-columns: 1fr; /* Mobile Default */
		gap: var(--space-md);
		width: 100%;
		padding-top: 185px; /* 165px game + 20px gap */
		position: static; /* Let absolute child allow positioning relative to home-content if needed? */
	}

	/* Desktop: 3 Columns, Content starts at Col 1 (Span 2) */
	@media (min-width: 1200px) {
		.hero-container {
			grid-template-columns: 1fr 1fr 1fr;
		}

		/* Align all direct children to start at column 1 (Left Aligned Layout) */
		/* Game, Bio, Actions span first 2 columns */
		.hero-container > :global(*) {
			grid-column: 1 / 3;
		}
	}

	/* Tablet: 2 Columns */
	@media (min-width: 768px) and (max-width: 1199px) {
		.hero-container {
			grid-template-columns: 1fr 1fr;
		}

		/* In 2-col layout (Tablet), if Sidebar is right fixed... usually overlay or adjust */
		/* If flip keeps logic: Content in Col 1, Social/Sidebar in Col 2? */
		/* Original was: Content Col 2, Nav Col 1. */
		/* Flip: Content Col 1, Nav Col 2. */

		.hero-container > :global(*) {
			grid-column: 1 / 3;
		}
	}

	/* Bio Content */
	.bio-content {
		padding-top: 0;
		padding-left: 20px;
		max-width: 100%; /* Matches Game Width */
	}

	.hero-actions-row {
		display: flex;
		align-items: baseline;
		flex-wrap: wrap;
		gap: 1.5rem;
		margin-top: 1rem;
		padding-left: 20px;
	}

	.hero-actions {
		display: flex;
		justify-content: flex-start; /* Align links to left */
		align-items: baseline;
		gap: 1.5rem;
	}

	/* Footer Alignment - Move to Left? Or keep Right? */
	/* If Layout Flipped, Footer usually follows main flow. */
	/* But footer is usually site-wide. Let's align left now? */
	.footer-alignment-wrapper {
		display: flex;
		justify-content: flex-start; /* Align Footer to Left */
		margin-top: 2rem;
	}

	/* Footer width matching right alignment preference */
	.footer-alignment-wrapper :global(.site-footer) {
		width: 100%; /* Full Width as requested */
		margin-bottom: 20px;
		margin-top: 240px !important; /* Restore valid top margin from previous global style */
	}

	/* Responsive */
	@media (max-width: 1024px) {
		.fixed-nav-top-right {
			position: static;
			width: 100%;
			margin-bottom: 2rem;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap; /* Prevent wrapping */
			justify-content: space-between; /* Sidebar Left, Socials Right */
			align-items: center;
			gap: 20px; /* Padding between items */
			padding: 20px; /* Padding all sides */
			box-sizing: border-box; /* Include padding in width */
			margin-bottom: 0; /* 0 Margin + 20px Padding = 20px Visual Gap */
		}

		.nav-wrapper-mobile {
			flex: 1 1 auto; /* Allow Sidebar to fill available space, but shrink if needed */
			min-width: 0; /* Critical for text truncation/shrinking in flex */
			position: relative; /* Context */
			z-index: 2; /* Ensure above spacer if any */
		}

		/* Override Sidebar Fixed Position on Mobile Home */
		.fixed-nav-top-right :global(.nav-bento-wrapper) {
			position: static !important; /* Force into flow */
			width: 100% !important;
			margin: 0 !important;
			transform: none !important;
			padding: 0 !important; /* Reset component padding if any */
			top: auto !important;
			left: auto !important;
			right: auto !important;
			border: none !important; /* Border handled by component or container? */
			/* Component has border: 1px solid var(--border-subtle); keep it? */
			/* If component border is on wrapper, keep it. Just position reset. */
		}

		/* Hide the spacer which pushes content down */
		.fixed-nav-top-right :global(.nav-spacer) {
			display: none !important;
		}

		/* Override width: 100% on nav trigger for mobile horizontal layout */
		.fixed-nav-top-right :global(.nav-trigger) {
			width: 100%; /* Fill the wrapper */
		}

		.fixed-nav-bottom-right {
			position: static;
			width: 100%;
			margin-bottom: 2rem;
		}

		.hero-container {
			grid-template-columns: 1fr;
			padding-left: 0;
		}

		.bio-content {
			padding-left: 20px;
			padding-top: 0;
		}

		.footer-alignment-wrapper {
			justify-content: center;
			padding-left: 0;
		}
	}

	/* Hero Section */
	.hero {
		padding: 0 0 3rem; /* EXACTLY 20px top padding as requested */
		font-weight: 400;
		font-size: 32px;
		border-bottom: 1px solid var(--border-subtle); /* Hero Separator */
		margin-bottom: 20px; /* Gap below line */
	}

	.hero-intro {
		font-size: 1.25rem;
		color: var(--text-secondary);
		max-width: 100%;
		line-height: 1.1;
	}

	/* Works Layer */
	.layer-works {
		position: relative;
		min-height: 100vh;
		background: var(
			--bg-primary
		); /* Ensure opaque background for layering */
		padding-bottom: var(--space-4xl);
		scroll-margin-top: 0; /* Ensure flush alignment with viewport top */
	}

	.works-header-sticky {
		position: sticky;
		top: 0;
		z-index: 5;
		padding: 0; /* Remove padding to be precise */
		margin-bottom: 36px; /* 36px gap to content */
		pointer-events: none; /* Let clicks pass through the empty areas */
	}

	@media (max-width: 1024px) {
		.works-header-sticky {
			top: 5rem !important; /* 80px: Force clear fixed nav (Tablet) */
		}
	}

	@media (max-width: 768px) {
		.works-header-sticky {
			top: 5rem !important; /* 80px: Force clear fixed nav (Mobile) */
		}
	}

	/* Renable pointer events for the filter itself */
	.works-header-sticky :global(*) {
		pointer-events: auto;
	}

	.categories-wrapper {
		display: flex;
		flex-direction: column;
		gap: var(--space-4xl);
	}

	/* Tablet View */
	@media (max-width: 1024px) {
		.home-content {
			padding: 20px 20px 0 20px;
		}
	}

	@media (max-width: 768px) {
		.hero-bio {
			font-size: 32px;
		}
		.home-content {
			padding: 20px 20px 0 20px;
		}
	}

	/* Hero Headline Styles */
	.hero-headline {
		text-align: left;
		max-width: 100%;
		font-weight: 500;
		letter-spacing: 0em;
		color: var(--text-secondary); /* Darker Grey base */
	}

	.bio-content {
		position: relative;
		transition: height 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
		overflow: visible;
	}

	.bio-short {
		width: 100%;
		font-size: 32px;
		line-height: 1.1;
		display: block; /* Default visible */
	}

	.bio-short .highlight {
		color: #e5e5e5;
	}

	/* Emoji Hover Effect */
	.emoji-hover {
		position: relative;
		cursor: pointer;
		transition: color 0.2s ease;
	}

	.emoji-hover:hover {
		color: var(--accent-secondary);
	}

	.emoji-display {
		position: absolute;
		bottom: -0.5em;
		right: -2.5em;
		font-size: 2em;
		pointer-events: none;
		min-height: 2em;
		display: flex;
		align-items: center;
	}

	@media (max-width: 1024px) {
		.emoji-display {
			position: static;
			font-size: 1.5em;
			margin-top: 0.25em;
			margin-bottom: 0.25em;
		}
	}

	.emoji-display.hidden {
		display: none;
	}
	:global([data-theme="light"]) .bio-short .highlight .u-item {
		text-decoration: underline;
		text-underline-offset: 4px;
		text-decoration-color: rgba(0, 0, 0, 0.4);
	}

	/* The parent highlight still controls color */
	:global([data-theme="light"]) .bio-short .highlight {
		color: var(--text-highlight);
	}

	.bio-long {
		width: 100%;
		/* max-width removed to span full width (2 columns) */
		display: none; /* Default hidden */
		opacity: 0;
		transition: opacity 0.4s ease;

		/* Remove grid-template-columns which forced width */
		/* grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); */
		gap: 1.25rem;
	}

	/* When active, we set display: block/grid in JS. 
	   If we use block, width works fine. */

	.bio-text {
		/* grid-column: 1 / 3; */ /* No longer needed if container is constrained */
		font-size: 16px;
		line-height: 1.4;
		color: var(--text-secondary);
	}

	@media (max-width: 768px) {
		/* Collapse to single column on mobile */
		.bio-text {
			grid-column: 1 / -1;
		}
		.bio-long {
			max-width: 100%;
			width: 100%;
		}
	}

	/* Sidebar Controls */
	.sidebar-controls {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	@media (min-width: 1025px) {
		.sidebar-controls {
			margin-top: auto;
			padding-top: var(--space-lg);
		}
	}

	@media (min-width: 1025px) {
		.sidebar-controls {
			width: 100%;
			justify-content: space-between;
		}
	}

	/* Hero Actions (Links) */
	.hero-actions {
		display: flex;
		justify-content: flex-start;
		gap: 1.5rem; /* Increased gap for text links */
		margin-top: 1rem;
	}

	.action-link {
		color: var(--text-secondary);
		font-size: 0.95rem; /* Slightly larger text */
		text-decoration: none;
		position: relative;
		background: none;
		border: none;
		padding: 0;
		cursor: pointer;
		font-family: inherit;
		display: inline-flex;
		align-items: center;
		line-height: 1;
		gap: 0.5rem;
		transition: color 0.2s ease;
	}

	.hero-actions .action-link {
		text-decoration: underline;
		text-underline-offset: 3px;
	}

	.hero-actions .action-link::after {
		display: none;
	}

	.action-link:hover {
		color: var(--accent-secondary);
	}

	/* Underline Animation */
	.action-link::after {
		content: "";
		position: absolute;
		bottom: -2px;
		left: 0;
		width: 100%;
		height: 1px;
		background-color: var(--accent-secondary);
		transform: scaleX(0);
		transform-origin: right;
		transition: transform 0.3s ease;
	}

	.action-link:hover::after {
		transform: scaleX(1);
		transform-origin: left;
	}

	/* Chevron Animation */
	.chevron {
		transition: transform 0.3s ease;
	}

	.read-more.active .chevron {
		transform: rotate(180deg);
	}
</style>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const readMoreBtn = document.getElementById("read-more-btn");
		const navAbout = document.getElementById("nav-about");
		const bioContent = document.querySelector(
			".bio-content",
		) as HTMLElement;
		const bioShort = document.querySelector(".bio-short") as HTMLElement;
		const bioLong = document.querySelector(".bio-long") as HTMLElement;

		if (readMoreBtn && bioContent && bioShort && bioLong) {
			const toggleBio = () => {
				readMoreBtn.classList.toggle("active");

				const isShortVisible =
					getComputedStyle(bioShort).display !== "none";

				// 1. Lock Container Height (Current State)
				const startHeight = bioContent.offsetHeight;
				bioContent.style.height = `${startHeight}px`;

				if (isShortVisible) {
					// EXPANDING: Short -> Long

					// Instant Disappear Short
					bioShort.style.display = "none";

					// Prepare Long (Grid)
					bioLong.style.display = "grid";
					bioLong.style.opacity = "0";

					// Measure Target Height
					// Unset container height temporarily to measure
					bioContent.style.height = "auto";
					const targetHeight = bioContent.scrollHeight;
					// Reset to start
					bioContent.style.height = `${startHeight}px`;

					// Force Reflow
					void bioContent.offsetWidth;

					// Animate
					bioContent.style.height = `${targetHeight}px`;
					bioLong.style.opacity = "1";
				} else {
					// COLLAPSING: Long -> Short

					// Instant Disappear Long
					bioLong.style.display = "none";
					bioLong.style.opacity = "0";

					// Prepare Short
					bioShort.style.display = "block";

					// Measure Target Height
					bioContent.style.height = "auto";
					const targetHeight = bioContent.scrollHeight;
					bioContent.style.height = `${startHeight}px`;

					// Force Reflow
					void bioContent.offsetWidth;

					// Animate
					bioContent.style.height = `${targetHeight}px`;
				}

				// Cleanup after transition
				setTimeout(() => {
					bioContent.style.height = "auto";
				}, 400);
			};

			// Read More Button Click
			readMoreBtn.addEventListener("click", (e) => {
				e.preventDefault();
				const scrollY = window.scrollY;
				toggleBio();
				// Restore scroll position immediately
				window.scrollTo(0, scrollY);
			});

			// Auto-Expand if URL has #about hash (on page load)
			if (window.location.hash === "#about") {
				if (!readMoreBtn.classList.contains("active")) {
					// Delay slightly to ensure DOM is ready
					setTimeout(() => {
						toggleBio();
					}, 100);
				}
			}

			// About Link Click - Use Native Redirect
			let isNavigatingToAbout = false; // Flag to prevent auto-collapse during navigation

			if (navAbout) {
				navAbout.addEventListener("click", (e) => {
					e.preventDefault();

					// Set flag to prevent auto-collapse
					isNavigatingToAbout = true;

					// 1. Expand Bio FIRST (before navigation)
					if (
						readMoreBtn &&
						!readMoreBtn.classList.contains("active")
					) {
						toggleBio();
					}

					// 2. Force Native Navigation (Hard Redirect)
					// This uses the browser's anchor behavior to jump to #about
					window.location.href = "/#about";
				});
			}
			// Auto-Collapse Logic (Silent with Scroll Compensation)
			let isCollapsing = false;
			window.addEventListener(
				"scroll",
				() => {
					if (isCollapsing) return; // Guard against re-entrant scroll events

					const worksSection = document.getElementById("works");

					// Only run if Expanded AND Works section exists AND not navigating to About
					if (
						readMoreBtn.classList.contains("active") &&
						worksSection &&
						!isNavigatingToAbout
					) {
						const worksTop = worksSection.offsetTop;
						const scrollY = window.scrollY;

						// Check if we have scrolled into Works (with a small buffer)
						if (scrollY > worksTop - 100) {
							isCollapsing = true;

							// 1. Snapshot relative position of the anchor element (Works)
							const worksViewportTop =
								worksSection.getBoundingClientRect().top;

							// 2. Disable smooth scroll & anchoring to prevent jump
							document.documentElement.style.scrollBehavior =
								"auto";
							document.body.style.overflowAnchor = "none";

							// 3. Hide container to prevent flash
							bioContent.style.transition = "none";
							bioContent.style.visibility = "hidden";

							// 4. Swap Content
							readMoreBtn.classList.remove("active");
							bioLong.style.display = "none";
							bioLong.style.opacity = "0";
							bioShort.style.display = "block";
							bioContent.style.height = "auto";

							// 5. Force layout update
							void bioContent.offsetHeight;

							// 6. Calculate new absolute position and scroll to restore viewport position
							const newWorksTop = worksSection.offsetTop;
							window.scrollTo(0, newWorksTop - worksViewportTop);

							// 7. Show content
							bioContent.style.visibility = "";

							// 8. Restore settings in next frame
							requestAnimationFrame(() => {
								document.documentElement.style.scrollBehavior =
									"";
								document.body.style.overflowAnchor = "";
								bioContent.style.transition = "";
								isCollapsing = false;
							});
						}
					}
				},
				{ passive: true },
			);

			// Emoji Hover Display
			const emojiDisplay = document.querySelector(
				".emoji-display",
			) as HTMLElement;
			const emojiHovers = document.querySelectorAll(".emoji-hover");

			emojiHovers.forEach((hover) => {
				hover.addEventListener("mouseenter", () => {
					const emoji = hover.getAttribute("data-emoji");
					if (emojiDisplay && emoji) {
						emojiDisplay.textContent = emoji;
						emojiDisplay.classList.remove("hidden");
					}
				});

				hover.addEventListener("mouseleave", () => {
					if (emojiDisplay) {
						emojiDisplay.classList.add("hidden");
					}
				});
			});

			// Hide emoji display initially
			if (emojiDisplay) {
				emojiDisplay.classList.add("hidden");
			}
		}
	});
</script>

<script>
	// Sticky Theme Toggle Collision Logic (desktop, tablet, and phone)
	function updateThemeTogglePosition() {
		const toggleContainer = document.querySelector(
			".toggle-floater",
		) as HTMLElement;
		// Target the actual .site-footer to ignore the wrapper margins/flex alignment
		const footer = document.querySelector(".site-footer") as HTMLElement;

		if (!toggleContainer || !footer) return;

		const footerRect = footer.getBoundingClientRect();
		const windowHeight = window.innerHeight;
		const baseBottom = 20;
		const gap = 20;

		// If footer enters viewport
		if (footerRect.top < windowHeight) {
			// We want bottom to be such that button is 'gap' px above footer top
			// newBottom = (windowHeight - footerRect.top) + gap
			const newBottom = windowHeight - footerRect.top + gap;
			toggleContainer.style.bottom = `${Math.max(
				baseBottom,
				newBottom,
			)}px`;
		} else {
			toggleContainer.style.bottom = `${baseBottom}px`;
		}
	}

	window.addEventListener("scroll", updateThemeTogglePosition, {
		passive: true,
	});
	window.addEventListener("resize", updateThemeTogglePosition);
	// Initial call (slight delay to ensure layout is ready)
	setTimeout(updateThemeTogglePosition, 100);
</script>
