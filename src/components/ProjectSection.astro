---
import PlaceholderImage from "./PlaceholderImage.astro";

interface Props {
    title: string;
    id?: string;
    placeholder?: boolean; /* If true, adds a placeholder image at bottom */
    hideTitle?: boolean; /* If true, hides title and divider for continuation sections */
    group?: string; /* ID of the parent section for sidebar highlighting */
    wide?: boolean; /* If true, section title aligns with full-width images */
}

const {
    title,
    id,
    placeholder = false,
    hideTitle = false,
    group,
    wide = false,
} = Astro.props;
---

<section
    class:list={["project-section", { continuation: hideTitle }]}
    id={id}
    data-toc-group={group}
>
    {!hideTitle && <div class="section-divider" />}

    <div class="hero-text-container">
        <div class:list={["header-group", { continuation: hideTitle }]}>
            <div class:list={["section-title", { wide }]}>
                {!hideTitle && <h3>{title}</h3>}
            </div>
            <div class="section-content">
                <slot />
            </div>
        </div>
    </div>
    {
        placeholder && (
            <div class="section-image">
                <PlaceholderImage height="400px" />
            </div>
        )
    }
</section>

<style>
    /* ===========================================
       PROJECT SECTION LAYOUT
       ===========================================
    */

    /* --- SPACING CONTROLS --- */
    .project-section {
        --title-width: 200px; /* Width of the title column */
        --column-gap: 32px; /* Gap between title and content */
        --section-margin: 6rem; /* Increased space between sections */
        --continuation-margin: 2rem; /* Reduced space for continuation sections */
        --image-spacing: 4rem; /* Space above images */

        display: flex;
        flex-direction: column;
        margin-top: var(--section-margin);
        margin-bottom: 0;
    }

    .project-section.continuation {
        margin-top: var(--continuation-margin);
    }

    /* Full Width Divider */
    .section-divider {
        width: 100%;
        border-top: 1px solid var(--border-subtle, rgba(0, 0, 0, 0.1));
        margin-bottom: 2rem; /* Spacing between line and content */
    }

    /* --- HERO TEXT CONTAINER (Centered on Desktop) --- */
    .hero-text-container {
        width: 100%;
        margin: 0 auto;
        /* No padding here â€” padding is applied per-element below */
        box-sizing: border-box;
    }

    /* --- HEADER GRID (Title + Text) --- */
    .header-group {
        display: flex;
        flex-direction: column;
        gap: 0.8rem; /* Vertical gap between title and content */
        overflow: visible;
        /* Border moved to .section-divider */
    }

    /* Hide divider for continuation sections */
    .header-group.continuation {
        padding-top: 0;
    }

    /* --- TITLE STYLING (Section Subheadings) --- */
    .section-title {
        padding-inline: max(0rem, calc(50% - 450px));
        box-sizing: border-box;
    }

    /* Wide variant: title aligns with full-width images */
    .section-title.wide {
        padding-inline: 0;
    }

    .section-title h3 {
        font-size: 2.25rem; /* 36px */
        font-weight: 800;
        color: var(--text-primary);
        line-height: 1.2;
        letter-spacing: -0.02em;
        margin: 0;
        /* Removed sticky positioning for vertical layout */
        font-family: "Public Sans", sans-serif;
    }

    /* --- CONTENT STYLING (Body Text) --- */
    .section-content {
        font-size: 1rem; /* 20px */
        line-height: 1.4; /* Reduced line spacing */
        font-weight: 300; /* Light */
        color: var(--text-secondary);
        font-family: "Public Sans", sans-serif;
        /* Padding moved to children to allow full-width images */
        padding-inline: 0;
        box-sizing: border-box;
        overflow: visible;
    }

    /* Default: All content children get the centered constraints */
    .section-content > :global(*) {
        padding-inline: max(0rem, calc(50% - 450px));
        box-sizing: border-box;
    }

    /* Style nested h3 headings within content */
    .section-content :global(h3) {
        font-size: 1.125rem; /* 18px - same as taglines */
        font-weight: 500; /* Normal */
        color: var(--text-primary);
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-family: "Public Sans", sans-serif;
    }

    .section-content :global(h3.prominent-title) {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    /* First paragraph aligns with title (no extra margin) */
    .section-content > :global(*:first-child) {
        margin-top: 0;
    }

    /* --- IMAGE STYLING --- */
    .section-image {
        margin-top: var(--image-spacing);
        width: 100%;
    }

    /* Style strong/bold text: Underlined and normal weight */
    .section-content :global(strong),
    .section-content :global(b) {
        font-weight: inherit;
        text-decoration: underline;
        color: inherit;
    }

    /* Images inside content are constrained to text box width */
    .section-content > :global(img),
    .section-content > :global(video),
    .section-content > :global(.placeholder-container) {
        width: 100%;
        max-width: 100%;
        display: block;
        border-radius: var(--radius-sm);
        margin-top: var(--image-spacing);
        margin-bottom: 2rem;
    }

    /* Full-width images inside section content get unified margins */
    .section-content :global(.full-width-image) {
        margin-top: 4rem !important;
        margin-bottom: 2rem !important;
    }

    /* Media components handle their own body-width padding */
    .section-content > :global(.full-width-image),
    .section-content > :global(.figma-container),
    .section-content > :global(.image-slider),
    .section-content > :global(.image-toggle-component),
    .section-content > :global(.video-switcher),
    .section-content > :global(.video-embed) {
        padding-inline: 0 !important;
        max-width: 100%;
    }

    /* PDFs removed from above list - they handle their own fullWidth prop */

    /* Exception: constrained media gets body-width padding */
    .section-content > :global(.full-width-image.constrained),
    .section-content > :global(.video-embed.constrained) {
        padding-inline: max(0rem, calc(50% - 450px)) !important;
    }


    .section-content :global(.grid-2) {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: var(--image-spacing);
    }

    .section-content :global(.grid-3) {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: var(--image-spacing);
    }

    /* Clickable Image Carousel */
    .section-content :global(.image-carousel) {
        cursor: pointer;
    }

    .section-content :global(.image-carousel img) {
        border: 2px solid #1a1a1a;
        border-radius: var(--radius-md, 12px);
        transition:
            border-color 0.2s ease,
            box-shadow 0.2s ease;
    }

    .section-content :global(.image-carousel:hover img) {
        border-color: var(--accent-secondary, #42bd49);
        box-shadow: 0 0 20px rgba(66, 189, 73, 0.6);
    }

    /* --- MOBILE LAYOUT --- */
    @media (max-width: 768px) {
        .header-group {
            grid-template-columns: 1fr; /* Stack title/text vertically */
            gap: 0.5rem;
        }

        .project-section {
            margin-bottom: 3rem;
        }

        .section-title h3 {
            position: static;
            margin-bottom: 0.5rem;
            font-size: 1.5rem; /* 24px for mobile title */
        }

        .section-content {
            font-size: 1rem; /* 16px for mobile body */
        }

        /* Reset image breakout for mobile stack */
        .section-content :global(img),
        .section-content :global(video),
        .section-content :global(.placeholder-container) {
            width: 100%;
            margin-left: 0;
        }
    }

    /* --- TABLET/MOBILE: Fluid container --- */
    @media (max-width: 1024px) {
        .hero-text-container {
            width: 100%;
        }
    }

    /* --- GLOBAL HELPERS FOR CONTENT --- */
    /* Centered Tagline (Responsive) */
    .section-content :global(.centered-tagline) {
        text-align: center;
        font-weight: 500;
        font-size: 1.125rem; /* 18px */
        line-height: 1.4;
        margin: 2rem 0;
        color: var(--text-primary);
    }

    /* List Tagline (Left aligned, for feature lists) */
    .section-content :global(.list-tagline) {
        display: block;
        font-weight: 600;
        font-size: 1rem; /* 16px - body text size */
        line-height: 1.4;
        margin-bottom: 0.25rem;
        color: var(--text-primary);
    }

    /* Feature Divider (Subtle line between items) */
    .section-content :global(.feature-divider) {
        border: 0;
        border-top: 1px dashed var(--border-subtle, rgba(0, 0, 0, 0.1));
        margin: 1rem 0;
    }

    /* Attribute Label (heading close to pills) */
    .section-content :global(.attribute-label) {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 0.5rem;
        margin-top: 1.5rem;
        color: var(--text-primary);
    }

    /* Attribute Pills Container */
    .section-content :global(.attribute-pills) {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    /* Attribute Pill (button-like, no hover) */
    .section-content :global(.attribute-pill) {
        display: inline-block;
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle, rgba(0, 0, 0, 0.1));
        padding: 6px 12px 4px 12px; /* Adjusted: +2px on top, -2px on bottom to move text down */
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Added blurred shadow */
    }

    @media (max-width: 768px) {
        .section-content :global(.centered-tagline) {
            font-size: 14px;
        }

        .section-content :global(.list-tagline) {
            font-size: 1rem; /* 16px on mobile, down from 20px */
        }

        .section-content :global(p) {
            font-size: 0.875rem; /* 14px on mobile */
        }
    }

    /* Bento Button Link */
    .section-content :global(.bento-button) {
        display: inline-flex;
        align-items: center;
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle, rgba(0, 0, 0, 0.1));
        padding: 4px 12px;
        border-radius: 8px;
        color: var(
            --accent-secondary
        ); /* Dark grey for contrast against light surface */
        text-decoration: none;
        font-size: 0.9em;
        font-weight: 500;
        transition: all 0.2s ease;
        margin: 8px 0 0 0; /* Top margin for spacing from text */
        vertical-align: middle;
    }

    .section-content :global(.bento-button:hover) {
        background: var(--bg-surface-hover);
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        color: #ee6b02;
    }
</style>
