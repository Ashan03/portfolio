---
interface Props {
    title: string;
    image?: string | ImageMetadata;
    href?: string;
    size?: "large" | "medium" | "small" | "wide" | "tall";
    tags?: string[];
}

import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

const { title, image, href = "#", size = "small", tags = [] } = Astro.props;

// Map sizes to grid column/row spans
const spanClasses = {
    large: "col-span-2 row-span-2",
    medium: "col-span-1 row-span-1",
    small: "col-span-1 row-span-1",
    wide: "col-span-2 row-span-1",
    tall: "col-span-1 row-span-2",
};

const spanClass = spanClasses[size] || spanClasses["small"];
---

<a href={href} class={`bento-item ${spanClass}`}>
    <div class="bento-card-visual">
        {
            image ? (
                <Image
                    src={image}
                    alt={title}
                    width={size === "large" || size === "wide" ? 1200 : 800}
                    height={size === "large" || size === "tall" ? 1000 : 600}
                    loading="lazy"
                    decoding="async"
                    class="card-image"
                />
            ) : (
                <div
                    class="placeholder-image"
                    style="background: var(--bg-surface); width: 100%; height: 100%;"
                />
            )
        }

        <!-- Overlay with Nested Bentos (Title + Tags) -->
        <div class="nested-bento-overlay">
            <div class="overlay-top-row">
                <h3 class="project-title-pill">{title}</h3>
            </div>

            {
                tags.length > 0 && (
                    <div class="tags-container">
                        {tags.slice(0, 3).map((tag) => (
                            <span class="mini-bento-tag">{tag}</span>
                        ))}
                    </div>
                )
            }
        </div>
    </div>
</a>

<style>
    .bento-item {
        display: flex;
        flex-direction: column;
        text-decoration: none;
        color: inherit;
        gap: 0; /* Title now lives inside the image overlay */
        height: auto;
        margin: 0; /* Let grid gap control all spacing */
    }

    /* The visual card itself */
    .bento-card-visual {
        position: relative;
        width: 100%;
        border-radius: var(--radius-md); /* 8px - Sidebar Navigation Radius */
        overflow: hidden;
        border: 1px solid var(--border-subtle); /* Faint bento edge */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .bento-item:hover .bento-card-visual {
        transform: translateY(-2px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }

    .card-image {
        width: 100%;
        height: auto; /* Preserve intrinsic aspect ratio */
        object-fit: contain; /* Avoid cropping */
        display: block;
        transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .bento-item:hover .card-image {
        transform: scale(1.03);
    }

    /* Nested Bento Overlay */
    .nested-bento-overlay {
        position: absolute;
        inset: 0;
        pointer-events: none;
        padding: 8px;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* Title at top, tags at bottom */
        align-items: stretch;
    }

    .overlay-top-row {
        display: flex;
        justify-content: flex-end;
    }

    .project-title-pill {
        font-size: 0.85rem;
        font-weight: 600;
        line-height: 1.2;
        color: var(--text-primary);
        background: var(--bg-surface);
        border: 1px solid var(--border-subtle);
        padding: 4px 8px;
        border-radius: calc(var(--radius-md) - 5px);
        max-width: 70%;
        text-align: right;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    .bento-item:hover .project-title-pill {
        background: var(--accent-secondary);
        color: #ffffff;
        border-color: var(--accent-secondary);
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .bento-item:hover .tags-container {
        opacity: 1;
        transform: translateY(0);
    }

    .mini-bento-tag {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: capitalize;
        color: var(--text-primary);
        background: var(--bg-surface); /* Contextual bento background */
        border: 1px solid var(--border-subtle);
        padding: 4px 8px;
        border-radius: calc(var(--radius-md) - 5px); /* 4px, keeps it boxy/bento-like */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        backdrop-filter: none; /* Solid bento */
    }

    :global(.dark) .mini-bento-tag {
        background: #2a2a2a;
        border-color: rgba(255, 255, 255, 0.1);
    }
</style>

<style is:global>
    .col-span-1 {
        grid-column: span 1;
    }
    .col-span-2 {
        grid-column: span 2;
    }
    .row-span-1 {
        grid-row: span 1;
    }
    .row-span-2 {
        grid-row: span 2;
    }

    @media (max-width: 768px) {
        .col-span-2 {
            grid-column: span 1 !important;
        }
        .row-span-2 {
            grid-row: span 1 !important;
        }
    }
</style>
