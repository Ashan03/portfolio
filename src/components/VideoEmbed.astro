---
interface Props {
    id: string;
    type: "vimeo" | "youtube";
    title?: string;
    description?: string;
    height?: string;
}

const {
    id,
    type,
    title = "Video",
    description,
    height = "500px",
} = Astro.props;

let embedUrl = "";
if (type === "vimeo") {
    // Extract ID from full URL if passed
    const match = id.match(/\d+/);
    const videoId = match ? match[0] : id;
    embedUrl = `https://player.vimeo.com/video/${videoId}?badge=0&autopause=0&player_id=0&app_id=58479`;
} else if (type === "youtube") {
    embedUrl = `https://www.youtube.com/embed/${id}`;
}
---

<figure class="video-embed">
    <div class="video-container">
        <iframe
            src={embedUrl}
            allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media"
            title={title}
            loading="lazy"></iframe>
    </div>
    {description && <figcaption>{description}</figcaption>}
</figure>

<style>
    .video-embed {
        width: 100%;
        margin-top: 4rem;
        margin-bottom: 2rem;
        /* Constrain to 900px body width */
        padding-inline: max(0rem, calc(50% - 450px));
        box-sizing: border-box;
    }

    .video-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        border-radius: var(--radius-md);
        background: var(--surface-secondary);
    }

    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    figcaption {
        text-align: center;
        font-size: 0.875rem;
        color: var(--text-tertiary);
        margin-top: 0.75rem;
    }
</style>
