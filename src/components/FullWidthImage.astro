---
import PlaceholderImage from "./PlaceholderImage.astro";
import { Image } from "astro:assets";

interface Props {
    src?: string;
    alt?: string;
    caption?: string;
    height?: string;
    loading?: "eager" | "lazy";
    constrain?: boolean;
    marginTop?: string;
}
const {
    src,
    alt = "",
    caption,
    height = "auto",
    loading = "lazy",
    constrain = true,
    marginTop,
} = Astro.props;
---

<figure
    class:list={["full-width-image", { constrained: constrain }]}
    style={marginTop ? { marginTop } : {}}
>
    {
        src ? (
            <Image
                src={src}
                alt={alt}
                width={1920}
                height={1080}
                class="optimized-image"
                loading={loading}
            />
        ) : (
            <div class="placeholder-wrapper">
                <PlaceholderImage height="100%" caption={caption} />
            </div>
        )
    }
    {src && caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
    .full-width-image {
        width: 100%;
        margin-top: 4rem;
        margin-bottom: 2rem;
    }

    .full-width-image.constrained {
        /* Constrain to 900px body width */
        padding-inline: max(0rem, calc(50% - 450px));
        box-sizing: border-box;
    }
    .full-width-image .optimized-image {
        width: 100%;
        height: auto;
        object-fit: contain;
        border-radius: var(--radius-md);
    }
    .placeholder-wrapper {
        width: 100%;
        height: 100%;
    }
    /* Ensure placeholder component fills the wrapper */
    .placeholder-wrapper :global(.placeholder-container),
    .placeholder-wrapper :global(.placeholder-box) {
        height: 100% !important;
    }
    figcaption {
        text-align: center;
        font-size: 0.875rem;
        color: var(--text-tertiary);
        margin-top: 0.5rem;
    }
</style>
