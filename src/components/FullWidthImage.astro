---
import PlaceholderImage from "./PlaceholderImage.astro";
import { Image } from "astro:assets";

interface Props {
    src?: string;
    alt?: string;
    caption?: string;
    height?: string;
    loading?: "eager" | "lazy";
    constrain?: boolean;
    marginTop?: string;
    scale?: number;
    objectFit?: "contain" | "cover";
    background?: string;
    padding?: string;
    overflow?: "hidden" | "visible";
    lockHeight?: boolean;
}
const {
    src,
    alt = "",
    caption,
    height = "auto",
    loading = "lazy",
    constrain = true,
    marginTop,
    scale = 1,
    objectFit = "contain",
    background,
    padding,
    overflow = "hidden",
    lockHeight = false,
} = Astro.props;
---

<figure
    class:list={["full-width-image", { constrained: constrain }]}
    style={marginTop ? { marginTop } : {}}
>
    {
        src ? (
            <div
                class="image-wrapper"
                style={{
                    ...(lockHeight ? { height } : {}),
                    ...(background ? { background } : {}),
                    ...(padding ? { padding } : {}),
                    overflow,
                }}
            >
                <Image
                    src={src}
                    alt={alt}
                    width={1920}
                    height={1080}
                    class="optimized-image"
                    loading={loading}
                    style={{
                        transform: `scale(${scale})`,
                        objectFit: objectFit,
                        height:
                            lockHeight && height !== "auto" ? "100%" : "auto",
                    }}
                />
            </div>
        ) : (
            <div class="placeholder-wrapper">
                <PlaceholderImage height="100%" caption={caption} />
            </div>
        )
    }
    {caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
    .full-width-image {
        width: 100%;
        margin-top: 4rem;
        margin-bottom: 4rem;
        /* Default: transparent */
    }

    .full-width-image.constrained {
        /* Constrain to 900px body width */
        padding-inline: max(0rem, calc(50% - 450px));
        box-sizing: border-box;
    }

    .image-wrapper {
        width: 100%;
        overflow: hidden;
        border-radius: var(--radius-md);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .full-width-image .optimized-image {
        width: 100%;
        height: auto;
        /* object-fit handled inline */
        border-radius: var(--radius-md);
        transition: transform 0.3s ease;
    }
    .placeholder-wrapper {
        width: 100%;
        height: 100%;
    }
    /* Ensure placeholder component fills the wrapper */
    .placeholder-wrapper :global(.placeholder-container),
    .placeholder-wrapper :global(.placeholder-box) {
        height: 100% !important;
    }
    figcaption {
        text-align: center;
        font-size: 0.875rem;
        color: var(--text-tertiary);
        margin-top: 0.5rem;
    }
</style>
